<!DOCTYPE html>

<html>

<head>

    <!-- Website Title & Description for Search Engine purposes -->
    <title>Rene Gens</title>
    <meta name="Online Resume" content="Personal Website about Rene Gens">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../css/freelancer.css" rel="stylesheet">
    <link href="../css/jquery.circliful.css" rel="stylesheet" type="text/css" />

    <!-- Custom Fonts -->

    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>



    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--load font awesome-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- Include Modernizr in the head, before any other Javascript -->
    <script src="../js/modernizr-2.6.2.min.js"></script>

</head>

	<!-- 					Navbar
    	===================================================== -->
<body id="page-top" class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top nav-justified">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="page-scroll">
                        <a href="../index.html">Home</a>
                    </li>
                    <li class="">
                        <a href="https://play.google.com/store/apps/developer?id=Rene%20Gens&hl=en" target="_blank">Android Playstore</a>
                    </li>
                    
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>

        <!-- /.container-fluid -->
    </nav>

     <!-- Page Content -->
    <div class="container" id="post">

        <div class="row">

            <!-- Blog Post Content Column -->
            <div class="col-lg-8 col-lg-offset-2 ">

                <!-- Blog Post -->

                <!-- Title -->
                <h1>Google Maps Location</h1>

                <!-- Author -->
                <p class="lead">
                    by <a href="../index.html">Rene Gens</a>
                </p>

                <hr>

                <!-- Date/Time -->
                <p><span class="glyphicon glyphicon-time"></span> Posted on August 24, 2013 at 9:00 PM</p>

                <hr>

                <!-- Preview Image -->
                <img class="img-responsive" src="../img/articles/googlemaps.png" alt="">

                <hr>

                <!-- Post Content -->
                <p>First tutorial and I will start with a good one. It occurred to me that the pretty little phones we have in our pockets are very good gps receivers and that location aware apps or apps that provide guidance with gps is a blessing. Some may argue about the ethics behind such thinks but this is not the topic of the current post. So I will describe the process of using Google Maps and Android location in your app. In particular I used it on the Want Milk app. Want Milk is getting the current position of the user using the fused location api from Google and is displaying some makers on the map.</p>
<p>When I first did these the guide that I used was published on <a title="Teamtreehouse Blog Android Location" href="http://blog.teamtreehouse.com/beginners-guide-location-android" target="_blank">teamtreehouse by Ben Jakuben</a>.</p>
<p>Fused location The Google Location Services API, part of Google Play Services, provides a more powerful, high-level framework that automates tasks such as location provider choice and power management. Location Services also provides new features such as activity detection that aren’t available in the framework API. Developers who are using the framework API, as well as developers who are just now adding location-awareness to their apps, should strongly consider using the Location Services API.</p>
<p>So this api is tied to the google play service which means that if on a device there is no google play installed we wont be able to get any accurate data. This means that we first have to add the Google Play Services SDK to the current SDK Manager provided by Android Studio.</p>
<p>After that we can go ahead and create the first template by selecting to start a new project and selecting the Google Maps Activity. Let it configure itself and wait a couple of minutes until graddle will have built everything.</p>
<p>The first screen you will see one key element you should not forget, in order to start using Google Maps you will need to provide a way to authenticate your application with Google Server by providing a SHA1 key to Google. This key is generated by Android Studio and you can get it from the google maps api.xml that is open. It will be somthing like this:</p>
<p style="padding-left: 30px;"><strong>85:42:7E:30:G5:33:15:0A:B3:54:A9:47:31:2C:F5:C4:3F:LD:33:11</strong></p>
<p>You will have to add this key together with the package name to the google api page. Do not foregt that this key is for debugging purposes which means you will have to generate a new SHA1 key for the production enviroment. If you look under the dependencies you will see a new line</p>
<p style="padding-left: 30px;">{<br />
compile &#8216;com.google.android.gms:play-services:6.5.87&#8242;<br />
}</p>
<p>This is how grandle tells to compile also the play services in the current version with the project.</p>
<h3>Let&#8217;s get to the code:</h3>
<p>If you see your Java source file you will see a map fragment together with the onCreate methods populated for you. The code is fine and usable. What it does is simple, it calls a fragment where your map is placed and a maker is placed at a default latitude and longtitude. In this case its the 0,0 position. If you compile and run this project it will generate an APK where when opened in a emulator or real device a map with a marker at the position will show up. If you change the .position(new LatLang(0,0)) to something else you will change the position of the marker.</p>
<p>So how do we get the current location? Simple first we have to make sure that our app permission include <em>&#8220;ACCESS_COARSE_LOCATION&#8221; and &#8220;ACCESS_FINE_LOCATION&#8221;</em>. After that we should create a new object from the GoogleApiClient and fiannly use as described in the official documentation.<br />
<code><br />
mGoogleApiClient = new GoogleApiClient.Builder(this)<br />
.addConnectionCallbacks(this)<br />
.addOnConnectionFailedListener(this)<br />
.addApi(LocationServices.API)<br />
.build();<br />
</code><br />
So what exactly are these lines doing for us? The first is to create a new GoogleApiClient object using the Builder pattern that you may have seen in Android with things like AlertDialogs. The methods are chained together to make the code easier to understand. The next two lines tell the new client that “this” current class (MapsActivity) will handle connection stuff. We’ll add that next.</p>
<p>The fourth line adds the LocationServices API endpoint from GooglePlayServices, and then finally the client is built for us. It’s almost ready to connect!</p>
<p>But first we need to implement some methods for those interfaces related to those two lines about callbacks and a listener. Getting a user’s location is an asynchronous process because it might take a little time to get the location data. We don’t want the app to be unresponsive while it’s waiting, so we do that work in the background. When that work is done in the background, it needs to get back to this main thread somehow. That’s where callbacks come in. The code we write in a callback method gets executed when that background work “calls back” with some sort of result.</p>
<p>We must implement GoogleApiClient.ConnectionCallbacks,GoogleApiClient.OnConnectionFailedListener so that the<br />
final class will look like this<br />
<code><br />
public class MapsActivity extends FragmentActivity implements<br />
GoogleApiClient.ConnectionCallbacks,<br />
GoogleApiClient.OnConnectionFailedListener<br />
</code><br />
After that we should import the new classes to our errors will go away and implement the missing methods.</p>
<p>After having the basic structure in place we should organize the connecting and disconnecting on our methods onResume(). The activity may be paused at any time and when we recall the activity lifecycle process you will see that after onCreate() the onResume() is called.</p>
<p><code>@Override<br />
protected void onResume() {<br />
super.onResume();<br />
setUpMapIfNeeded();<br />
mGoogleApiClient.connect();<br />
}</code></p>
<p>Don&#8217;t foregt to add the appropriate metho on our onPause() so we disconnect from the service and dont waste cpu cycles and battery power.</p>
<p><code>@Override<br />
protected void onPause() {<br />
super.onPause();<br />
if (mGoogleApiClient.isConnected()) {<br />
mGoogleApiClient.disconnect();<br />
}<br />
}</code></p>
<h3>Getting the last location</h3>
<blockquote><p>Using the Google Play services location APIs, your app can request the last known location of the user’s device. In most cases, you are interested in the user’s current location, which is usually equivalent to the last known location of the device.</p></blockquote>
<p>on the onConnected() method add the following<br />
<code><br />
Location location = LocationServices.FusedLocationApi.getLastLocation(mGoogleApiClient); </code></p>
<p>You should always remember to incoporate a null check in case we dont have a location and request a new one.</p>
<p><code>if (location == null) {<br />
// Blank for a moment...<br />
}<br />
else {<br />
handleNewLocation(location);<br />
};</code></p>
<h3>HANDLING ERRORS</h3>
<p>We won’t do anything special about the error cases, but it’s important to know that Google Play Services includes some built-in mechanisms for handling certain errors. The first thing we need is a constant static member variable at the top of our MapsActivity class. This defines a request code to send to Google Play services, which is returned in Activity.onActivityResult():</p>
<p><code>private final static int CONNECTION_FAILURE_RESOLUTION_REQUEST = 9000;</code></p>
<p>Then paste the code below into the onConnectionFailed() method. There are more detailed comments in the source on GitHub, and check the documentation for a little more information.</p>
<p><code>@Override<br />
public void onConnectionFailed(ConnectionResult connectionResult) {<br />
if (connectionResult.hasResolution()) {<br />
try {<br />
// Start an Activity that tries to resolve the error<br />
connectionResult.startResolutionForResult(this, CONNECTION_FAILURE_RESOLUTION_REQUEST);<br />
} catch (IntentSender.SendIntentException e) {<br />
e.printStackTrace();<br />
}<br />
} else {<br />
Log.i(TAG, "Location services connection failed with code " + connectionResult.getErrorCode());<br />
}<br />
}</code></p>
<h3>Requesting Location Updates</h3>
<p>Next thing on the list is to get request those location updates so we can use them is our code. This is priamry used run-tracking app or navigation application.<br />
For this we need to implement a LocationListener interface and be sure to use the <em>com.google.android.gms.location</em>. After that fix the error by implementing the interface methods. You will see the onLocationChanged() method. This method gets called every time a new location is detected by the Google Play service and is silently working in the background updating the location. To use it in our Activity we will use the a method we have already implemented handlNewLocation()</p>
<p><code>@Override<br />
public void onLocationChanged(Location location) {<br />
handleNewLocation(location);<br />
}<br />
</code></p>
<h3>Starting a request</h3>
<p>To be able to start a request we have a mehtod for it <em>onLocationChanged()</em> but we don&#8217;t have anything set up to call it. So we will create a new object <em>LocationRequest</em> and intiliaze it in on the <em>onCreate()</em> .</p>
<p><code>// Create the LocationRequest object<br />
mLocationRequest = LocationRequest.create()<br />
.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY)<br />
.setInterval(10 * 1000) // 10 seconds, in milliseconds<br />
.setFastestInterval(1 * 1000); // 1 second, in milliseconds</code></p>
<p>&nbsp;</p>
<p>So what does it do? First thing we set the priority to <a title="Location Request" href="(https://developer.android.com/reference/com/google/android/gms/location/LocationRequest.html)" target="_blank">high accuracy</a> which means we want location updates as accurate as possbile. This mode also drains the most battery. If we don&#8217;t need so high accuracy we can lower the value.<br />
Next up is the Interval which means when the location update is triggered. Higher number means more frequent updates. Lastly the last line is an option as to when receive location updates when other apps are requesting it. Since this is shared across android you can &#8220;steal the location&#8221;.</p>
<p>Now we just need to use this request. We use it with our GoogleApiClient using a special method from the fused location provider. Let’s add this line in our <em>onConnected()</em> method where we check to see if the last location is null:<br />
<code>@Override<br />
public void onConnected(Bundle bundle) {<br />
Location location = LocationServices.FusedLocationApi.getLastLocation(mGoogleApiClient);<br />
if (location == null) {<br />
LocationServices.FusedLocationApi.requestLocationUpdates(mGoogleApiClient, mLocationRequest, this);<br />
}<br />
else {<br />
handleNewLocation(location);<br />
}<br />
}</code></p>
<p>As reminder this code is requesting only if the last location is not known.</p>
<p>When finished we should remove and updates in the <em>onPause()</em> method<br />
<code>@Override<br />
protected void onPause() {<br />
super.onPause();<br />
if (mGoogleApiClient.isConnected()) {<br />
LocationServices.FusedLocationApi.removeLocationUpdates(mGoogleApiClient, this);<br />
mGoogleApiClient.disconnect();<br />
}<br />
}<br />
</code></p>
<h3>Showing a location on the map</h3>
<p>When you scroll down the template you will see have made a <em>setUpMap()</em> where there is a <em>mMap.addMarker</em>.</p>
<p>The following lines of code will be added in our handleNewLocation() helper method. First, we can get the latitude and longitude coordinates of the location using these two methods from the Location class:</p>
<p><code>double currentLatitude = location.getLatitude();<br />
double currentLongitude = location.getLongitude();</code></p>
<p>We then can create a LatLng object that stores the information.</p>
<p><code>LatLng latLng = new LatLng(currentLatitude, currentLongitude); </code></p>
<p>and change the method to<br />
<code>MarkerOptions options = new MarkerOptions()<br />
.position(latLng)<br />
.title("I am here!");<br />
mMap.addMarker(options);</code></p>
<p>That&#8217;s all there is. Seems quite a lot of work but you can save this and whenever you need to get a user location you can use this method and implement this in your apps.</p>
<p>&nbsp;</p>
</div>
                <hr>

        </div>
        </div>
        <!-- /.row -->



       <footer class="text-center" id="social">
        <div class="footer-above">
            <div class="container">
                <div class="row">
                    <div class="footer-col col-md-4 col-md-offset-4">
                        <h3>Around the Web</h3>
                        <ul class="list-inline">             
                        <li><a class="btn-social btn-outline" href="https://www.linkedin.com/in/renegens" target="_blank"><i class="fa fa-lg fa-linkedin"></i></a></li>
                        <li><a class="btn-social btn-outline" href="https://github.com/renegens" target="_blank"><i class="fa fa-lg fa-github"></i></a></li>
                        <li><a class="btn-social btn-outline" href="https://careers.stackoverflow.com/renegens" target="_blank"><i class="fa fa-lg fa-stack-exchange"></i></a></li>
                        <li><a class="btn-social btn-outline" href="https://plus.google.com/u/0/+ReneGens" target="_blank"><i class="fa fa-lg fa-google-plus"></i></a></li>
                        <li><a class="btn-social btn-outline" href="https://www.pinterest.com/renegens/" target="_blank"><i class="fa fa-lg fa-pinterest"></i></a></li>
                        </ul>
                    </div>
                   
                </div>
            </div>
        </div>
    </footer>

    <footer class="text-center" id="social">
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        Copyright &copy; Rene Gens 2015
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll visible-xs visble-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>


    
    <!-- All Javascript at the bottom of the page for faster page loading -->

    <!-- jQuery -->
    <script src="..js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="..js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="..js/classie.js"></script>

 

    <!-- Custom Theme JavaScript -->
    <script src="..js/freelancer.js"></script>



</body>

</html>
